<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Junction Simulation</title>
  <style>
    /* Load SF Pro font at normal weight */
    @font-face {
      font-family: 'SF Pro';
      src: url("{{ url_for('static', filename='fonts/SF-Pro.ttf') }}") format('truetype');
      font-style: normal;
      font-weight: 400;
    }

    /* Reset & base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      /* Allow vertical scroll so we can see Start button when dropdowns expand */
      overflow-x: hidden;
      overflow-y: auto;
    }

    body {
      background-color: #a2bf89; /* Green background */
      font-family: 'SF Pro', sans-serif;
      font-weight: 400; /* Normal weight everywhere */
      color: #6b6b6b;
      display: flex;
      flex-direction: column;
    }

    /* Main container to manage vertical space */
    .main-container {
      flex: 1; /* Take remaining vertical space */
      display: flex;
      flex-direction: column;
    }

    /* Header: left-aligned heading with top margin */
    .header {
      margin: 4vh 5vh 0 5vh; /* 4vh top, 5vh sides, 0 bottom */
    }

    .header h1 {
      color: #f8f5e9;
      font-size: 4vh;
      text-align: left; /* left-aligned */
    }

    /* Content area for top row + bottom box */
    .content {
      /* Make all outer margins and gaps consistent */
      margin: 4vh 5vh; 
      display: flex;
      flex-direction: column;
      gap: 2vh; /* vertical gap between top row & bottom box */
      flex: 1;
    }

    /* Top row: three side-by-side boxes, same size */
    .top-row {
      display: flex;
      gap: 2vh; /* uniform gap */
      align-items: stretch; /* ensure equal height boxes */
      flex: 1; /* let top row grow in height */
    }

    /* Boxes (all top boxes + bottom) */
    .box,
    .bottom-box {
      background-color: #f8f5e9;
      border-radius: 1.2vh; /* more rounding */
      padding: 2vh;
      display: flex;
      flex-direction: column;
    }

    /* Let each top box flex equally */
    .box {
      flex: 1; 
      min-height: 0; /* let flex container control the height */
    }

    /* Titles inside the boxes */
    .box h2 {
      color: #8da676;
      font-size: 2vh;
      margin-bottom: 2vh;
    }

    /* Dropdown headings */
    .dropdown-heading {
      cursor: pointer;
      font-weight: 400;
      font-size: 1.5vh;
      margin: 2vh 0 1vh;
      display: flex;
      align-items: center;
    }

    .dropdown-heading span.symbol {
      margin-right: 8px;
      color: #8da676;
      font-size: 1.5vh;
      font-weight: bold;
    }

    /* Drop-down content hidden by default */
    .dropdown-content {
      display: none;
      margin-left: 1vh;
      margin-bottom: 2vh;
    }

    .dropdown-content ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .dropdown-content li {
      display: flex;
      align-items: center;
      margin: 1vh 0;
    }

    .dropdown-content li label {
      flex: 0 0 8vh;
      margin-right: 1vh;
      font-size: 1.25vh;
    }

    .dropdown-content li input[type="text"] {
      flex: 1;
      padding: 0.5vh 1vh;
      font-size: 1.25vh;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    /* Traffic Light Settings list */
    .traffic-light-settings {
      list-style: none;
      padding: 0;
      margin: 1vh 0;
    }

    .traffic-light-settings li {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin: 1vh 0;
      width: 100%;
    }

    /* Ensure all labels have the same width so text aligns */
    .traffic-light-settings li label {
      flex: 0 0 17vh; /* Set a fixed width for labels */
      text-align: left;
      font-size: 1.5vh;
    }

    /* Ensure all input fields have the same width */
    .traffic-light-settings li input {
      flex: 0 0 5vh; /* Set a fixed width for all input fields */
      padding: 0.5vh 1vh;
      font-size: 1.25vh;
      border: 1px solid #ccc;
      border-radius: 4px;
      text-align: center;
    }

    /* Force a width on all number inputs in traffic-light-settings-sub */
    .traffic-light-settings li input[type="number"] {
      width: 7vh; /* or 80px, or whatever you prefer */
      max-width: 8em; /* optional max width if you want to cap it */
    }


    /* Slider container (Number of lanes) */
    .slider-container {
      margin: 2vh 0;
    }

    .slider-container label {
      display: block;
      margin-bottom: 1vh;
      font-weight: 400;
      font-size: 1.5vh;
    }

    .slider-container input[type="range"] {
      width: 80%;
    }

    /* Numbers below the slider */
    .slider-values {
      display: flex;
      justify-content: space-between;
      width: 80%;
      margin-top: 1vh;
    }

    .slider-values span {
      font-size: 1.25vh;
    }

    /* Checkbox container */
    .checkbox-container {
      display: flex;
      align-items: center;
      margin-bottom: 2vh;
    }

    .checkbox-container label {
      margin-left: 1vh;
      font-size: 1.5vh;
    }

    /* Disabled input styling */
    input:disabled {
      background-color: #ddd;
      color: #888;
    }

    /* Bottom box (spans full width) */
    .bottom-box {
      flex: 0.4; /* ~40% of the leftover space in content */
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    /* Drag-and-drop area inside the bottom box */
    .drag-drop-box {
      border: 2px dashed #8da676;
      border-radius: 1vh;
      padding: 3vh 2vh;
      color: #6b6b6b;
      cursor: pointer;
      max-width: 600px;
      margin: 0 auto;
    }

    .drag-drop-box p {
      font-size: 1.5vh;
      margin: 1vh 0;
    }

    /* Hide the file input (custom UI) */
    #file-input {
      display: none;
    }

    /* Upload button style */
    .upload-button {
      margin-top: 3vh;
      width: 30vh;
      padding: 1vh 2vh;
      background-color: #f8f5e9;
      color: #a2bf89;
      border: none;
      border-radius: 2vh;
      cursor: pointer;
      font-size: 3vh;
      border-radius: 6vh;
      margin: 3vh auto 0; /* Centering the button */
      display: block; /* Ensure proper centering */
      font-weight: bold;
    }

    .upload-button:hover {
      background-color: #789563;
    }

    /* Responsive text sizing fallback for smaller screens */
    @media (max-width: 600px) {
      .header h1 {
        font-size: 6vh;
      }
      .dropdown-heading span.symbol {
        font-size: 4vh;
      }
      .dropdown-heading {
        font-size: 3vh;
      }
      .dropdown-content li label {
        flex: 0 0 30vh;
      }
      .dropdown-content li input[type="text"] {
        font-size: 3vh;
      }
      .traffic-light-settings li label {
        flex: 0 0 30vh;
      }
      .traffic-light-settings li input[type="number"] {
        font-size: 3vh;
      }
      .slider-container label,
      .slider-values span,
      .checkbox-container label {
        font-size: 3vh;
      }
      .drag-drop-box p {
        font-size: 3vh;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Toggle logic for each drop-down (only one open at a time)
      const dropdowns = document.querySelectorAll('.dropdown-heading');
      dropdowns.forEach(heading => {
        heading.addEventListener('click', () => {
          const content = heading.nextElementSibling;
          // Close all other dropdowns
          dropdowns.forEach(other => {
            if (other !== heading) {
              const otherContent = other.nextElementSibling;
              otherContent.style.display = 'none';
              other.querySelector('.symbol').textContent = '‚Äî';
            }
          });
          // Toggle current dropdown
          if (content.style.display === 'block') {
            content.style.display = 'none';
            heading.querySelector('.symbol').textContent = '‚Äî';
          } else {
            content.style.display = 'block';
            heading.querySelector('.symbol').textContent = '|';
          }
        });
      });

      // Drag & Drop functionality for file upload area
      const dropZone = document.querySelector('.drag-drop-box');
      const fileInput = document.getElementById('file-input');
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '#ececec';
      });
      dropZone.addEventListener('dragleave', () => {
        dropZone.style.backgroundColor = '#f8f5e9';
      });
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '#f8f5e9';
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
        }
      });
      dropZone.addEventListener('click', () => {
        fileInput.click();
      });

      // Toggle enable/disable for Traffic Light Settings inputs
      const tlCheckbox = document.getElementById('traffic-light-enable');
      const tlInputs = document.querySelectorAll('.traffic-light-settings input[type="number"]');
      tlCheckbox.addEventListener('change', () => {
        tlInputs.forEach(input => {
          input.disabled = !tlCheckbox.checked;
        });
      });
      // Set initial state for traffic light inputs
      tlInputs.forEach(input => {
        input.disabled = !tlCheckbox.checked;
      });

      // When the Start button is clicked, copy the parameter values into the hidden form and submit it.
      document.getElementById("startButton").addEventListener("click", async function () {
        try {
          // ‚úÖ Step 1: Start FastAPI before submitting form
          let startResponse = await fetch('/start_simulation', { method: 'POST' });
          let startData = await startResponse.json();

          if (startResponse.ok) {
              console.log("‚úÖ FastAPI started:", startData.message);

              // ‚úÖ Step 2: Copy form values to hidden fields
              document.getElementById("hidden_nb_forward").value = document.getElementById("nb_forward").value;
              document.getElementById("hidden_nb_left").value = document.getElementById("nb_left").value;
              document.getElementById("hidden_nb_right").value = document.getElementById("nb_right").value;

              document.getElementById("hidden_eb_forward").value = document.getElementById("eb_forward").value;
              document.getElementById("hidden_eb_left").value = document.getElementById("eb_left").value;
              document.getElementById("hidden_eb_right").value = document.getElementById("eb_right").value;

              document.getElementById("hidden_sb_forward").value = document.getElementById("sb_forward").value;
              document.getElementById("hidden_sb_left").value = document.getElementById("sb_left").value;
              document.getElementById("hidden_sb_right").value = document.getElementById("sb_right").value;

              document.getElementById("hidden_wb_forward").value = document.getElementById("wb_forward").value;
              document.getElementById("hidden_wb_left").value = document.getElementById("wb_left").value;
              document.getElementById("hidden_wb_right").value = document.getElementById("wb_right").value;

              document.getElementById("hidden_lanes").value = document.getElementById("lanes").value;
              document.getElementById("hidden_left-turn").value = document.getElementById("left-turn").checked ? "on" : "";
              document.getElementById("hidden_bus-lane").value = document.getElementById("bus-lane").checked ? "on" : "";
              document.getElementById("hidden_pedestrian_frequency").value = document.getElementById("pedestrian-frequency").value;
              document.getElementById("hidden_pedestrian_duration").value = document.getElementById("pedestrian-duration").value;
              
              // Traffic Light Settings values
              document.getElementById("hidden_tl_enabled").value = tlCheckbox.checked ? "on" : "";
              document.getElementById("hidden_sequences").value = document.getElementById("tl_sequences").value;
              document.getElementById("hidden_vmain").value = document.getElementById("tl_vmain").value;
              document.getElementById("hidden_hmain").value = document.getElementById("tl_hmain").value;
              document.getElementById("hidden_vright").value = document.getElementById("tl_vright").value;
              document.getElementById("hidden_hright").value = document.getElementById("tl_hright").value;

              // ‚úÖ Step 3: Submit the hidden form after FastAPI has started
              console.log("üöÄ Submitting form with updated values...");
              document.getElementById("hiddenForm").submit();
          } else {
              console.error("‚ùå Error starting FastAPI:", startData.error);
          }
        } catch (error) {
          console.error("‚ùå Error sending start request:", error);
        }
      });
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const lanesSlider = document.getElementById("lanes");
      lanesSlider.addEventListener("input", function() {
        localStorage.setItem("numOfLanes", this.value);
      });
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const pedestrianDurationInput = document.getElementById("pedestrian-duration");
      // Check if a value exists in localStorage
      const storedDuration = localStorage.getItem("pedestrianDuration");
      if (storedDuration !== null) {
        // Use the stored value if it exists
        pedestrianDurationInput.value = storedDuration;
      } else {
        // Otherwise, set a default value (e.g., "2") and store it
        pedestrianDurationInput.value = "1";
        localStorage.setItem("pedestrianDuration", "1");
      }
      // Update localStorage whenever the input changes
      pedestrianDurationInput.addEventListener("input", function() {
        localStorage.setItem("pedestrianDuration", this.value);
      });
    });
  </script>  
  <script>
    // Function to compute sequence lengths (mirroring your Python function)
    function getSequenceLengths(vehicleData) {
      let main_vertical = 0, main_horizontal = 0, vertical_right = 0, horizontal_right = 0;
      const increment = 4;
      
      // Parse values and ensure numbers
      const north = vehicleData.north || {};
      const south = vehicleData.south || {};
      const east  = vehicleData.east  || {};
      const west  = vehicleData.west  || {};
    
      const vertical_total = (parseInt(north.forward) || 0) + (parseInt(north.left) || 0) +
                             (parseInt(south.forward) || 0) + (parseInt(south.left) || 0);
      const horizontal_total = (parseInt(east.forward) || 0) + (parseInt(east.left) || 0) +
                               (parseInt(west.forward) || 0) + (parseInt(west.left) || 0);
      const vertical_right_total = (parseInt(north.right) || 0) + (parseInt(south.right) || 0);
      const horizontal_right_total = (parseInt(east.right) || 0) + (parseInt(west.right) || 0);
      
      const total = vertical_total + horizontal_total + vertical_right_total + horizontal_right_total;
      
      if (total > 0) {
        const raw_main_vertical = 60 * (vertical_total / total);
        const raw_main_horizontal = 60 * (horizontal_total / total);
        const raw_vertical_right = 60 * (vertical_right_total / total);
        const raw_horizontal_right = 60 * (horizontal_right_total / total);
        
        main_vertical = Math.ceil(raw_main_vertical / increment);
        main_horizontal = Math.ceil(raw_main_horizontal / increment);
        vertical_right = Math.ceil(raw_vertical_right / increment);
        horizontal_right = Math.ceil(raw_horizontal_right / increment);
      }
      
      return { main_vertical, main_horizontal, vertical_right, horizontal_right };
    }
    
    // Function to compute cycle times (using 2-second transitions as in your Python code)
    function getCycleTimes(seqLengths) {
      const gap = 1;
      const verticalCycleTime = (5 * gap) + seqLengths.main_vertical + seqLengths.vertical_right;
      const horizontalCycleTime = (5 * gap) + seqLengths.main_horizontal + seqLengths.horizontal_right;
      return { verticalCycleTime, horizontalCycleTime };
    }
    
    // Function to compute maximum gaps per minute given a cycle gap time
    function getMaxGapsPerMinute(seqLengths, gap) {
      const cycleTimes = getCycleTimes(seqLengths);
      // Full cycle includes a vertical cycle + gap + horizontal cycle + gap.
      const fullCycleTime = cycleTimes.verticalCycleTime + cycleTimes.horizontalCycleTime;
      // Each full cycle yields 2 gaps.
      return 2 * (60 / fullCycleTime);
    }
    
    // Function to update calculations in real time
    function updateCalculations() {
      // Read current vehicle input values from the form
      const vehicleData = {
        north: {
          forward: document.getElementById('nb_forward').value,
          left: document.getElementById('nb_left').value,
          right: document.getElementById('nb_right').value
        },
        east: {
          forward: document.getElementById('eb_forward').value,
          left: document.getElementById('eb_left').value,
          right: document.getElementById('eb_right').value
        },
        south: {
          forward: document.getElementById('sb_forward').value,
          left: document.getElementById('sb_left').value,
          right: document.getElementById('sb_right').value
        },
        west: {
          forward: document.getElementById('wb_forward').value,
          left: document.getElementById('wb_left').value,
          right: document.getElementById('wb_right').value
        }
      };
    
      // Get sequence lengths based on current vehicle data
      const seqLengths = getSequenceLengths(vehicleData);
      // Define gap duration (in seconds) as needed
      const gap = document.getElementById('pedestrian-duration').value;
    
      // Calculate max pedestrian frequency (gaps per minute)
      const maxGaps = getMaxGapsPerMinute(seqLengths, gap);
    
      // Update the pedestrian frequency input's max attribute
      const pedInput = document.getElementById('pedestrian-frequency');
      pedInput.max = maxGaps;
    }
    
    // Attach the update function to all vehicle input fields so it runs on every change
    document.addEventListener('DOMContentLoaded', function () {
      const vehicleInputs = [
        'nb_forward', 'nb_left', 'nb_right',
        'eb_forward', 'eb_left', 'eb_right',
        'sb_forward', 'sb_left', 'sb_right',
        'wb_forward', 'wb_left', 'wb_right'
      ];
    
      vehicleInputs.forEach(function(id) {
        const inputField = document.getElementById(id);
        if (inputField) {
          inputField.addEventListener('input', updateCalculations);
        }
      });
    });
    </script>
<script>
  // Replicate your Python calculations in JavaScript

  function updateAndValidateTrafficSettings() {
    // Retrieve the number of sequences and set gap duration
    let sequences = parseInt(document.getElementById("tl_sequences").value) || 1;
    let gap = 1;
    
    // Retrieve the current green time values
    let vmainInput = document.getElementById("tl_vmain");
    let vrightInput = document.getElementById("tl_vright");
    let hmainInput = document.getElementById("tl_hmain");
    let hrightInput = document.getElementById("tl_hright");
    
    let vmain = parseInt(vmainInput.value) || 0;
    let vright = parseInt(vrightInput.value) || 0;
    let hmain = parseInt(hmainInput.value) || 0;
    let hright = parseInt(hrightInput.value) || 0;
    
    // Calculate total vertical and horizontal values
    // Adding (5 * gap) as the fixed transition time component
    let vTotal = vmain + vright + (5 * gap);
    let hTotal = hmain + hright + (5 * gap);
    
    // Compute the maximum allowed totals for each direction
    let maxV = 60 - hTotal;
    let maxH = 60 - vTotal;
    
    // Validate vertical green times
    if (vTotal > maxV) {
      vright = Math.max(0, maxV - (vmain + (5 * gap)));
      vrightInput.value = vright;
      console.log("Adjusted vertical_right_green to", vright, "to meet max allowed vertical sum of", maxV);
    }
    
    // Validate horizontal green times
    if (hTotal > maxH) {
      hright = Math.max(0, maxH - (hmain + (5 * gap)));
      hrightInput.value = hright;
      console.log("Adjusted horizontal_right_green to", hright, "to meet max allowed horizontal sum of", maxH);
    }
    
    // Return the normalized values (dividing by number of sequences)
    return {
      vertical_main_green: vmain / sequences,
      vertical_right_green: vright / sequences,
      horizontal_main_green: hmain / sequences,
      horizontal_right_green: hright / sequences,
    };
  }


  // Attach event listeners to update limits and validate as the user types:
  document.addEventListener('DOMContentLoaded', function () {
    // When tl_sequences changes, update the limits and validate the green fields
    document.getElementById("tl_sequences").addEventListener('input', () => {
      updateAndValidateTrafficSettings();
    });
    // Also attach validation to the green fields
    const greenFields = ["tl_vmain", "tl_vright", "tl_hmain", "tl_hright"];
    greenFields.forEach(id => {
      document.getElementById(id).addEventListener('input', updateAndValidateTrafficSettings);
    });
  });


  
  // Compute cycle times (using 2-second transitions as in Python)
  function getCycleTimes(seqLengths, gap) {
    const verticalCycleTime = seqLengths.main_vertical + seqLengths.vertical_right + 5*gap;
    const horizontalCycleTime = seqLengths.main_horizontal + seqLengths.horizontal_right + 5*gap;
    return { verticalCycleTime, horizontalCycleTime };
  }
  
  // Calculate max gap opportunities per minute
  function getMaxGapsPerMinute(seqLengths, gap) {
    const cycleTimes = getCycleTimes(seqLengths, gap);
    const maxVerticalGaps = 60 / cycleTimes.verticalCycleTime;
    const maxHorizontalGaps = 60 / cycleTimes.horizontalCycleTime;
    return maxVerticalGaps + maxHorizontalGaps;
  }
  
  // This function reads the current vehicle data, calculates max gaps,
  // and updates the max attribute of the pedestrian frequency input.
  function updatePedestrianMax() {
    const vehicleData = {
      north: {
        forward: document.getElementById('nb_forward').value,
        left: document.getElementById('nb_left').value,
        right: document.getElementById('nb_right').value
      },
      east: {
        forward: document.getElementById('eb_forward').value,
        left: document.getElementById('eb_left').value,
        right: document.getElementById('eb_right').value
      },
      south: {
        forward: document.getElementById('sb_forward').value,
        left: document.getElementById('sb_left').value,
        right: document.getElementById('sb_right').value
      },
      west: {
        forward: document.getElementById('wb_forward').value,
        left: document.getElementById('wb_left').value,
        right: document.getElementById('wb_right').value
      }
    };

    let enabled = document.getElementById("traffic-light-enable").checked;

    if (enabled) {
      const seqLengths = updateAndValidateTrafficSettings();
    } else {
      const seqLengths = getSequenceLengths(vehicleData);
    }
    const gap = 1; // Adjust gap duration as needed
    const maxGaps = getMaxGapsPerMinute(seqLengths, gap);
    
    // Update the pedestrian frequency input's max attribute
    const pedInput = document.getElementById('pedestrian-frequency');
    pedInput.max = Math.floor(maxGaps);
  }
  
  // Attach updatePedestrianMax to all vehicle input frequency
  document.addEventListener('DOMContentLoaded', function () {
    const vehicleInputs = [
      'nb_forward', 'nb_left', 'nb_right',
      'eb_forward', 'eb_left', 'eb_right',
      'sb_forward', 'sb_left', 'sb_right',
      'wb_forward', 'wb_left', 'wb_right'
    ];
  
    vehicleInputs.forEach(function(id) {
      const field = document.getElementById(id);
      if (field) {
        field.addEventListener('input', updatePedestrianMax);
      }
    });
  });
</script> 
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // These are your traffic light input IDs
    const trafficLightFields = ["tl_vmain", "tl_vright", "tl_hmain", "tl_hright"];

    trafficLightFields.forEach(id => {
      const field = document.getElementById(id);
      if (field) {
        // For each input change, call the function that updates your max calc
        field.addEventListener("input", () => {
          // If your main function is updatePedestrianMax, call that:
          updatePedestrianMax(); 
          // Or if you rely on updateAndValidateTrafficSettings, call that too:
          updateAndValidateTrafficSettings();
        });
      }
    });
  });
</script>

</head>
<body>
  <div class="main-container">
    <!-- Header -->
    <div class="header">
      <h1>Input your parameters</h1>
    </div>

    <!-- Content -->
    <div class="content">
      <!-- Top row: Visible parameters form -->
      <form id="parameterForm">
        <div class="top-row">
          <!-- Left box -->
          <div class="box">
            <h2>Vehicle Settings</h2>
            <!-- North -->
            <div class="dropdown-heading">
              <span class="symbol">‚Äî</span> North
            </div>
            <div class="dropdown-content">
              <ul>
                <li>
                  <label for="nb_forward">Forward</label>
                  <input type="text" id="nb_forward" name="nb_forward">
                </li>
                <li>
                  <label for="nb_left">Turning Left</label>
                  <input type="text" id="nb_left" name="nb_left">
                </li>
                <li>
                  <label for="nb_right">Turning Right</label>
                  <input type="text" id="nb_right" name="nb_right">
                </li>
              </ul>
            </div>
            <!-- East -->
            <div class="dropdown-heading">
              <span class="symbol">‚Äî</span> East
            </div>
            <div class="dropdown-content">
              <ul>
                <li>
                  <label for="eb_forward">Forward</label>
                  <input type="text" id="eb_forward" name="eb_forward">
                </li>
                <li>
                  <label for="eb_left">Turning Left</label>
                  <input type="text" id="eb_left" name="eb_left">
                </li>
                <li>
                  <label for="eb_right">Turning Right</label>
                  <input type="text" id="eb_right" name="eb_right">
                </li>
              </ul>
            </div>
            <!-- South -->
            <div class="dropdown-heading">
              <span class="symbol">‚Äî</span> South
            </div>
            <div class="dropdown-content">
              <ul>
                <li>
                  <label for="sb_forward">Forward</label>
                  <input type="text" id="sb_forward" name="sb_forward">
                </li>
                <li>
                  <label for="sb_left">Turning Left</label>
                  <input type="text" id="sb_left" name="sb_left">
                </li>
                <li>
                  <label for="sb_right">Turning Right</label>
                  <input type="text" id="sb_right" name="sb_right">
                </li>
              </ul>
            </div>
            <!-- West -->
            <div class="dropdown-heading">
              <span class="symbol">‚Äî</span> West
            </div>
            <div class="dropdown-content">
              <ul>
                <li>
                  <label for="wb_forward">Forward</label>
                  <input type="text" id="wb_forward" name="wb_forward">
                </li>
                <li>
                  <label for="wb_left">Turning Left</label>
                  <input type="text" id="wb_left" name="wb_left">
                </li>
                <li>
                  <label for="wb_right">Turning Right</label>
                  <input type="text" id="wb_right" name="wb_right">
                </li>
              </ul>
            </div>
          </div>

          <!-- Middle box -->
          <div class="box">
            <h2>Junction Settings</h2>
            <!-- Number of lanes slider -->
            <div class="slider-container">
              <label for="lanes">Number of lanes</label>
              <input type="range" id="lanes" name="lanes" min="1" max="5" value="2">
              <div class="slider-values">
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
              </div>
            </div>
            <!-- Left-turn lane checkbox -->
            <div class="checkbox-container">
              <input type="checkbox" id="left-turn" name="left-turn" checked>
              <label for="left-turn">Left-Turn Lane</label>
            </div>
            <!-- Bus-lane checkbox -->
            <div class="checkbox-container">
              <input type="checkbox" id="bus-lane" name="bus-lane">
              <label for="bus-lane">Bus Lane</label>
            </div>
            <!-- Pedestrians -->
            <div style="display: flex; align-items: center; margin: 2vh 0 1vh;">
              <label for="pedestrian-frequency" style="font-size: 1.5vh; font-weight: 400; margin-right: 1.5vh; cursor: default;">
                Pedestrian Frequency per Hour
              </label>
              <input type="number" id="pedestrian-frequency" name="pedestrian-frequency" min="0" max="5" style="padding: 0.5vh 1vh; font-size: 1.5vh; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="display: flex; align-items: center; margin: 2vh 0 1vh;">
              <label for="pedestrian-duration" style="font-size: 1.5vh; font-weight: 400; margin-right: 1.5vh; cursor: default;">
                Pedestrian Duration per Event
              </label>
              <input type="number" id="pedestrian-duration" name="pedestrian-duration" min="0" max="5" style="padding: 0.5vh 1vh; font-size: 1.5vh; border: 1px solid #ccc; border-radius: 4px;">
            </div>
          </div>

          <!-- Right box: Traffic Light Settings -->
          <div class="box">
            <h2>Traffic Light Settings</h2>
            
            <!-- Enable Traffic Light Settings checkbox -->
            <div class="checkbox-container">
              <input type="checkbox" id="traffic-light-enable" name="traffic-light-enable">
              <label for="traffic-light-enable">Enable Traffic Light Settings</label>
            </div>
          
            <!-- Sequences per Hour -->
            <ul class="traffic-light-settings">
              <li>
                <label for="tl_sequences">Traffic Cycles per Hour</label>
                <input type="number" id="tl_sequences" name="tl_sequences" min="2" max="12" value="0" step="2">
              </li>
            </ul>
          
            <!-- Vertical Settings -->
            <div class="dropdown-heading">
              <span class="symbol">‚Äî</span> Vertical Sequence Lengths
            </div>
            <div class="dropdown-content">
              <ul class="traffic-light-settings">
                <li>
                  <label for="tl_vmain">Main Green Length</label>
                  <input type="number" id="tl_vmain" name="tl_vmain" min="0" value="0">
                </li>
                <li>
                  <label for="tl_vright">Right Green Length</label>
                  <input type="number" id="tl_vright" name="tl_vright" min="0" value="0">
                </li>
              </ul>
            </div>
          
            <!-- Horizontal Settings -->
            <div class="dropdown-heading">
              <span class="symbol">‚Äî</span> Horizontal Sequence Lengths
            </div>
            <div class="dropdown-content">
              <ul class="traffic-light-settings">
                <li>
                  <label for="tl_hmain">Main Green Length</label>
                  <input type="number" id="tl_hmain" name="tl_hmain" min="0" value="0">
                </li>
                <li>
                  <label for="tl_hright">Right Green Length</label>
                  <input type="number" id="tl_hright" name="tl_hright" min="0" value="0">
                </li>
              </ul>
            </div>
          </div>
        </div>
      </form>

      <!-- Bottom box: File Upload area -->
      <form action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data" style="flex: 0;">
        <div class="bottom-box">
          <div class="drag-drop-box">
            <p style="font-size: 3vh;">+</p>
            <p>Drag and Drop your Settings File</p>
            <p>or</p>
            <p>Click to Browse Files from your Computer</p>
          </div>
          <input type="file" name="file" id="file-input" />
          <br>
        </div>
      </form>

      <!-- Hidden Final Submission Form: Contains hidden copies of parameter values and the Start button -->
      <form id="hiddenForm" action="/parameters" method="POST" enctype="multipart/form-data">
        <!-- Hidden inputs for parameters -->
        <input type="hidden" id="hidden_nb_forward" name="nb_forward" value="">
        <input type="hidden" id="hidden_nb_left" name="nb_left" value="">
        <input type="hidden" id="hidden_nb_right" name="nb_right" value="">

        <input type="hidden" id="hidden_eb_forward" name="eb_forward" value="">
        <input type="hidden" id="hidden_eb_left" name="eb_left" value="">
        <input type="hidden" id="hidden_eb_right" name="eb_right" value="">

        <input type="hidden" id="hidden_sb_forward" name="sb_forward" value="">
        <input type="hidden" id="hidden_sb_left" name="sb_left" value="">
        <input type="hidden" id="hidden_sb_right" name="sb_right" value="">

        <input type="hidden" id="hidden_wb_forward" name="wb_forward" value="">
        <input type="hidden" id="hidden_wb_left" name="wb_left" value="">
        <input type="hidden" id="hidden_wb_right" name="wb_right" value="">

        <input type="hidden" id="hidden_lanes" name="lanes" value="">
        <input type="hidden" id="hidden_left-turn" name="left-turn" value="">
        <input type="hidden" id="hidden_bus-lane" name="bus-lane" value="">
        <input type="hidden" id="hidden_pedestrian_frequency" name="pedestrian-frequency" value="">
        <input type="hidden" id="hidden_pedestrian_duration" name="pedestrian-duration" value="">
        
        <!-- Hidden inputs for Traffic Light Settings -->
        <input type="hidden" id="hidden_tl_enabled" name="traffic-light-enable" value="">
        <input type="hidden" id="hidden_sequences" name="tl_sequences" value="">
        <input type="hidden" id="hidden_vmain" name="tl_vmain" value="">
        <input type="hidden" id="hidden_hmain" name="tl_hmain" value="">
        <input type="hidden" id="hidden_vright" name="tl_vright" value="">
        <input type="hidden" id="hidden_hright" name="tl_hright" value="">

        <!-- The visible Start button -->
        <button class="upload-button" type="button" id="startButton">Start</button>
      </form>

    </div>
  </div>
</body>
</html>
